<html>
<head>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script type="text/javascript">
		//SORTING FUNCTIONS
		//Inputs are arrays with the following format [<key>, <value>] (represents a JSON property)
		var sorts = ['none','lexographicKeySort', 'lexographicValueSort'];
		function lexographicKeySort(a,b) {
			if(a[0] > b[0]) return 1;
			else if(a[0] == b[0]) return 0;
			else return -1;
		}
		
		function lexographicValueSort(a,b) {
			if(a[1] > b[1]) return 1;
			else if(a[1] == b[1]) return 0;
			else return -1;
		}
		
		//FILTERING FUNCTIONS
		//Inputs is an array with the following format [key, value] (represents a JSON property)
		var filters = ['none','removeFunctions'];
		function removeFunctions(arr) {
			return arr[1].substr(0,8).localeCompare('function') == 0;
		}
		
		//Strip starting and ending whitespace from a string
		function strip(s) {
			return s.replace(/^\s+|\s+$/g,'')
		}
		
		//Similar functionality to python's join
		function join(s, arr) {
			var str = arr[0];
			for(var i = 1; i < arr.length; i++) {
				str += s + arr[i];
			}
			return str;
		}
		
		function generateJSON(vals) {
			var json = '{\n';
			json += join(',\n', vals.map(function(x) { return '\t' + x[0] + ' : ' + x[1] }));
			json += '\n}';
			return json;
		}
		
		function work() {
			var text = $('#text').val();
			//Parse JSON
			parsedVals = text.substring(text.indexOf('{') + 1,text.lastIndexOf('}')).split(',').map(function(s) { return s.split(':').map(strip); });
			
			filterFunc = $('#filter').val();
			sortFunc = $('#sort').val();
			
			if(strip(filterFunc) != '') parsedVals.filter(eval(filterFunc));
			if(strip(sortFunc) != '') parsedVals.sort(eval(sortFunc));
			
			//Generate new JSON and convert to screen readable format
			var json = generateJSON(parsedVals);
			$('#result').html(json.replace(/\n/g, '<br/>').replace(/\t/g, '&nbsp&nbsp&nbsp&nbsp'));
		}
		
		function changeFilterFunc() {
			var flv = $('#filterList').val();
			var filterVal = flv == 'none' ? '' : window[flv].toString(); 
			$('#filter').val(filterVal);
		}
		
		function changeSortFunc() {
			var slv = $('#sortList').val();
			var sortVal = slv == 'none' ? '' : window[slv].toString(); 
			$('#sort').val(sortVal);
		}
		
		$(function() {
			var sortList = $('#sortList'); 
			for(var idx in sorts) {
			    $('<option />', {value: sorts[idx], text: sorts[idx]}).appendTo(sortList);
			}
			var filterList = $('#filterList'); 
			for(var idx in filters) {
			    $('<option />', {value: filters[idx], text: filters[idx]}).appendTo(filterList);
			}
		});
	</script>
</head>
<body>
	<div style="float:left;">
	<h1>Inputs Here</h1>
	<h2>JSON</h2>
   	<textarea id="text" name="text" cols="75" rows="10" placeholder="JSON"></textarea>
	<br/>
	<h2>Filter function</h2>
	<div>Examples: <select id="filterList" onchange="changeFilterFunc()"></select></div>
	<textarea id="filter" name="filter" cols="75" rows="10" placeholder="filter"></textarea>
	<br/>
	<h2>Sort function</h2>
	<div>Examples: <select id="sortList" onchange="changeSortFunc()"></select></div>
	<textarea id="sort" name="sort" cols="75" rows="10" placeholder="sort"></textarea>
	<br/>
	<input id="submitBtn" value="run" type="button" onclick='javascript:work()'>
	</div>
	<div style="float:left;margin-left:40px">
	<h1>Results</h1>
	<div id="result"></div>
	</div>
</body>
</html>